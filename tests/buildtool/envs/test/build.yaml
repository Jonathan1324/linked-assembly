config:
  default_env: general
  default_targets:
  - main

toolchains:
  main:
    tools:
      CC:
        type: compiler
        when:
          ext:
          - c
          type: source
          out: object
        command: gcc -c ${ INPUT } -MMD -MF ${ OUTPUT }.d -o ${ OUTPUT }
        message: Compiling ${ INPUT }
      CXX:
        type: compiler
        when:
          ext:
          - cpp
          - cxx
          - c++
          type: source
          out: object
        command: g++ -c ${ INPUT } -MMD -MF ${ OUTPUT }.d -o ${ OUTPUT }
        message: Compiling ${ INPUT }
      
      LD:
        type: linker
        when:
          type: object
          out: executable
        combine_inputs: true
        command: g++ ${ INPUT } -o ${ OUTPUT }
        message: Linking ${ OUTPUT }

environments:
  general:
    toolchain: main
    build_dir: build
    vars:
      SRC_DIR: src

targets:
  main:
    path: ${ $env.SRC_DIR }
    config: build.yaml
    outputs:
      main:
        type: executable
    env: general
