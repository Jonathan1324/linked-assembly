config:
  default_env: general
  default_targets:
  - project1
  - project2

formats:
  gcc_deps:
    start:
      ignore_lines: 2
      trim:
        if: "  "
        remove: 2
    end:
      ignore_lines: 0
      trim:
        if: "\\"
        remove: 1

toolchains:
  main:
    tools:
      CC:
        type: compiler
        when:
          ext:
          - c
          type: source
          out: object
        dep_path: ${ OUTPUT }.d
        dep_format: gcc_deps
        command: gcc -c ${ INPUT } -MMD -MF ${ OUTPUT }.d -o ${ OUTPUT }
        message: Compiling ${ NAME }.${ EXT }
      CXX:
        type: compiler
        when:
          ext:
          - cpp
          - cxx
          - c++
          type: source
          out: object
        dep_path: ${ OUTPUT }.d
        dep_format: gcc_deps
        command: g++ -c ${ INPUT } -MMD -MF ${ OUTPUT }.d -o ${ OUTPUT }
        message: Compiling ${ NAME }.${ EXT }
      
      LD:
        type: linker
        when:
          type: object
          out: executable
        combine_inputs: true
        command: g++ ${ INPUT } -o ${ OUTPUT }
        message: Linking ${ ONAME }

environments:
  general:
    toolchain: main
    build_dir: build
    vars:
      SRC_DIR: src
  project1:
    toolchain: main
    build_dir: ${ env.build_dir }/project1
    vars:
      SRC_DIR: src/project1
  project2:
    toolchain: main
    build_dir: ${ env.build_dir }/project2
    vars:
      SRC_DIR: src/project2

targets:
  project1:
    path: ${ $env.SRC_DIR }
    config: build.yaml
    outputs:
      main:
        type: executable
    env: project1
  project2:
    path: ${ $env.SRC_DIR }
    config: build.yaml
    outputs:
      main:
        type: executable
    env: project2
