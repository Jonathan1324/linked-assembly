default:
  tools:
    CC:
      when:
        ext:
        - c
        out: object
      deps: ${ OUTPUT }.d
      format: default_gcc_deps

      flags: C_FLAGS
      command:
      - gcc ${ FLAGS } -c ${ INPUT } -MMD -MF ${ OUTPUT }.d -o ${ OUTPUT }
      message: Compiling ${ INPUT }

    CXX:
      when:
        ext:
        - cpp
        out: object
      deps: ${ OUTPUT }.d
      format: default_gcc_deps

      flags: CXX_FLAGS
      command:
      - g++ ${ FLAGS } -c ${ INPUT } -MMD -MF ${ OUTPUT }.d -o ${ OUTPUT }
      message: Compiling ${ INPUT }

    LD:
      when:
        out: executable

      flags: LD_FLAGS
      command:
      - g++ ${ INPUT } ${ FLAGS } -o ${ OUTPUT }
      message: Linking ${ OUTPUT }

    AR:
      when:
        out: static-library

      flags: AR_FLAGS
      command:
      - ar ${ FLAGS } ${ OUTPUT } ${ INPUT }
      message: Creating static library ${ OUTPUT }

  flagsets:
    GCC_ALWAYS:
    - "-Wall"
    - "-Wextra"
    - "-Wpedantic"
    - "-Wconversion"

    GCC_DEBUG:
    - "-g"
    - "-O0"
    - "-fsanitize=address,undefined"
    - "-fno-omit-frame-pointer"

    GCC_RELEASE:
    - "-O3"
    - "-DNDEBUG"
    - "-flto"

    C_ALWAYS:
    - "-std=c11"

    CXX_ALWAYS:
    - "-std=c++17"

    AR_ALWAYS:
    - "rcs"

    GCC_WARNINGS_EXTRA:
    - "-Wshadow"
    - "-Wformat=2"
    - "-Wundef"
    - "-Wunreachable-code"

    GCC_SANITIZERS:
    - "-fsanitize=address"
    - "-fsanitize=undefined"
    - "-fno-omit-frame-pointer"

  flags:
    C_FLAGS:
      global:
        always:
        - GCC_ALWAYS
        - C_ALWAYS
        modes:
          debug:
          - GCC_DEBUG
          release:
          - GCC_RELEASE
      platforms:
        windows:
          always: []
          modes: {}
        linux:
          always: []
          modes: {}
        macos:
          always: []
          modes: {}

    CXX_FLAGS:
      global:
        always:
        - GCC_ALWAYS
        - CXX_ALWAYS
        modes:
          debug:
          - GCC_DEBUG
          release:
          - GCC_RELEASE
      platforms:
        windows:
          always: []
          modes: {}
        linux:
          always: []
          modes: {}
        macos:
          always: []
          modes: {}

    LD_FLAGS:
      global:
        always: []
        modes: {}
      platforms:
        windows:
          always: []
          modes: {}
        linux:
          always: []
          modes: {}
        macos:
          always: []
          modes: {}

    AR_FLAGS:
      global:
        always:
        - AR_ALWAYS
        modes: {}
      platforms:
        windows:
          always: []
          modes: {}
        linux:
          always: []
          modes: {}
        macos:
          always: []
          modes: {}
